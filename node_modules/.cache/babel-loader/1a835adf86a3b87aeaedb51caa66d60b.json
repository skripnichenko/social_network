{"ast":null,"code":"import _regeneratorRuntime from\"/home/skripnichenko/social_network/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/skripnichenko/social_network/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/home/skripnichenko/social_network/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{stopSubmit}from'redux-form';import{authAPI,securityAPI}from'./../API/api';var SET_USER_DATA='/auth/SET_USER_DATA';var GET_CAPTCHA_URL_SUCCESS='/auth/GET_CAPTCHA_URL_SUCCESS';var initialState={userId:null,email:null,login:null,isAuth:false,captchaUrl:null};var authReducer=function authReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_USER_DATA:return _objectSpread(_objectSpread(_objectSpread({},state),action.payload),{},{isAuth:action.payload.isAuth});case GET_CAPTCHA_URL_SUCCESS:return _objectSpread(_objectSpread({},state),action.payload);default:return state;};};export var setAuthUserData=function setAuthUserData(userId,email,login,isAuth){return{type:SET_USER_DATA,payload:{userId:userId,email:email,login:login,isAuth:isAuth}};};export var getCaptchaUrlSuccess=function getCaptchaUrlSuccess(captchaUrl){return{type:GET_CAPTCHA_URL_SUCCESS,payload:{captchaUrl:captchaUrl}};};export var getAuthUserData=function getAuthUserData(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var response,_response$data$data,id,_login,email;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return authAPI.me();case 2:response=_context.sent;if(response.data.resultCode===0){_response$data$data=response.data.data,id=_response$data$data.id,_login=_response$data$data.login,email=_response$data$data.email;dispatch(setAuthUserData(id,email,_login,true));};case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var login=function login(email,password,rememberMe,captcha){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var response,message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return authAPI.login(email,password,rememberMe,captcha);case 2:response=_context2.sent;if(response.data.resultCode===0){dispatch(getAuthUserData());}else{if(response.data.resultCode===10){dispatch(getCaptchaUrl());}message=response.data.messages.length>0?response.data.messages[0]:'Some error';dispatch(stopSubmit('login',{_error:message}));}case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var logout=function logout(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return authAPI.logout();case 2:response=_context3.sent;if(response.data.resultCode===0){dispatch(setAuthUserData(null,null,null,false));};case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var getCaptchaUrl=function getCaptchaUrl(){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var response,captcha;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return securityAPI.getCaptchaUrl();case 2:response=_context4.sent;captcha=response.data.url;dispatch(getCaptchaUrlSuccess(captcha));case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();};export default authReducer;","map":{"version":3,"sources":["/home/skripnichenko/social_network/src/redux/auth-reducer.js"],"names":["stopSubmit","authAPI","securityAPI","SET_USER_DATA","GET_CAPTCHA_URL_SUCCESS","initialState","userId","email","login","isAuth","captchaUrl","authReducer","state","action","type","payload","setAuthUserData","getCaptchaUrlSuccess","getAuthUserData","dispatch","me","response","data","resultCode","id","password","rememberMe","captcha","getCaptchaUrl","message","messages","length","_error","logout","url"],"mappings":"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","sourcesContent":["import { stopSubmit } from 'redux-form';\nimport { authAPI, securityAPI } from './../API/api';\n\nconst SET_USER_DATA = '/auth/SET_USER_DATA';\nconst GET_CAPTCHA_URL_SUCCESS = '/auth/GET_CAPTCHA_URL_SUCCESS';\n\nlet initialState = {\n    userId: null,\n    email: null,\n    login: null,\n    isAuth: false,\n    captchaUrl: null\n};\n\nconst authReducer = (state = initialState, action) => {\n    switch (action.type) {\n\n        case SET_USER_DATA:\n            return { ...state, ...action.payload, isAuth: action.payload.isAuth };\n        case GET_CAPTCHA_URL_SUCCESS:\n            return {...state, ...action.payload}\n\n        default:\n            return state;\n    };\n};\nexport const setAuthUserData = (userId, email, login, isAuth) => ({ type: SET_USER_DATA, payload: { userId, email, login, isAuth } });\nexport const getCaptchaUrlSuccess = (captchaUrl) => ({ type: GET_CAPTCHA_URL_SUCCESS, payload: {captchaUrl}})\n\nexport const getAuthUserData = () => async (dispatch) => {\n    let response = await authAPI.me();\n    if (response.data.resultCode === 0) {\n        let { id, login, email } = response.data.data;\n        dispatch(setAuthUserData(id, email, login, true));\n    };\n\n}\n\nexport const login = (email, password, rememberMe, captcha) => async (dispatch) => {\n    let response = await authAPI.login(email, password, rememberMe, captcha);\n    if (response.data.resultCode === 0) {\n        dispatch(getAuthUserData());\n    } else {\n        if (response.data.resultCode === 10) {\n            dispatch(getCaptchaUrl());\n        }\n        let message = response.data.messages.length > 0 ? response.data.messages[0] : 'Some error';\n        dispatch(stopSubmit('login', { _error: message }));\n    }\n\n}\n\nexport const logout = () => async (dispatch) => {\n    let response = await authAPI.logout()\n    if (response.data.resultCode === 0) {\n        dispatch(setAuthUserData(null, null, null, false));\n    };\n}\n\nexport const getCaptchaUrl = () => async (dispatch) => {\n    let response = await securityAPI.getCaptchaUrl();\n    const captcha = response.data.url;\n    dispatch(getCaptchaUrlSuccess(captcha));\n}\n\nexport default authReducer;"]},"metadata":{},"sourceType":"module"}