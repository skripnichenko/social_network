{"ast":null,"code":"import _regeneratorRuntime from\"/home/skripnichenko/social_network/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/skripnichenko/social_network/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/home/skripnichenko/social_network/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/skripnichenko/social_network/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{updateObjectInArray}from'../utils/object-helpers';import{usersAPI}from'../API/api';var FOLLOW='FOLLOW';var UNFOLLOW='UNFOLLOW';var SET_USERS='SET_USERS';var SET_CURRENT_PAGE='SET_CURRENT_PAGE';var SET_TOTAL_USER_COUNT='SET_TOTAL_USER_COUNT';var TOGGLE_IS_FETCHING='TOGGLE_IS_FETCHING';var TOGGLE_IS_FOLLOWING_PROGRESS='TOGGLE_IS_FOLLOWING_PROGRESS';var initialState={users:[],pageSize:10,totalUsersCount:0,currentPage:1,isFetching:false,followingInProgress:[]};var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,'id',{followed:true})});case UNFOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,'id',{followed:false})});case SET_USERS:return _objectSpread(_objectSpread({},state),{},{users:action.users});case SET_CURRENT_PAGE:return _objectSpread(_objectSpread({},state),{},{currentPage:action.currentPage});case SET_TOTAL_USER_COUNT:return _objectSpread(_objectSpread({},state),{},{totalUsersCount:action.totalUsersCount});case TOGGLE_IS_FETCHING:return _objectSpread(_objectSpread({},state),{},{isFetching:action.isFetching});case TOGGLE_IS_FOLLOWING_PROGRESS:return _objectSpread(_objectSpread({},state),{},{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!==action.userId;})});default:return state;};};export var followSuccess=function followSuccess(userId){return{type:FOLLOW,userId:userId};};export var unfollowSuccess=function unfollowSuccess(userId){return{type:UNFOLLOW,userId:userId};};export var setUsers=function setUsers(users){return{type:SET_USERS,users:users};};export var setCurrentPage=function setCurrentPage(currentPage){return{type:SET_CURRENT_PAGE,currentPage:currentPage};};export var setTotalUserCount=function setTotalUserCount(totalUsersCount){return{type:SET_TOTAL_USER_COUNT,totalUsersCount:totalUsersCount};};export var toggleIsFetching=function toggleIsFetching(isFetching){return{type:TOGGLE_IS_FETCHING,isFetching:isFetching};};export var toggleIsFollowingProgress=function toggleIsFollowingProgress(isFetching,userId){return{type:TOGGLE_IS_FOLLOWING_PROGRESS,isFetching:isFetching,userId:userId};};export var getUsers=function getUsers(currentPage,pageSize){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(toggleIsFetching(true));dispatch(setCurrentPage(currentPage));_context.next=4;return usersAPI.getUsers(currentPage,pageSize);case 4:data=_context.sent;dispatch(toggleIsFetching(false));dispatch(setUsers(data.items));dispatch(setTotalUserCount(data.totalCount));case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,userId,apiMethod,actionCreator){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(toggleIsFollowingProgress(true,userId));_context2.next=3;return apiMethod(userId);case 3:response=_context2.sent;if(response.resultCode===0){dispatch(actionCreator(userId));};dispatch(toggleIsFollowingProgress(false,userId));case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function followUnfollowFlow(_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:followUnfollowFlow(dispatch,userId,usersAPI.followUser.bind(usersAPI),followSuccess);case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x6){return _ref3.apply(this,arguments);};}();};export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:followUnfollowFlow(dispatch,userId,usersAPI.unfollowUser.bind(usersAPI),unfollowSuccess);case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x7){return _ref4.apply(this,arguments);};}();};export default usersReducer;","map":{"version":3,"sources":["/home/skripnichenko/social_network/src/redux/users-reducers.js"],"names":["updateObjectInArray","usersAPI","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_USER_COUNT","TOGGLE_IS_FETCHING","TOGGLE_IS_FOLLOWING_PROGRESS","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","userId","followed","filter","id","followSuccess","unfollowSuccess","setUsers","setCurrentPage","setTotalUserCount","toggleIsFetching","toggleIsFollowingProgress","getUsers","dispatch","data","items","totalCount","followUnfollowFlow","apiMethod","actionCreator","response","resultCode","follow","followUser","bind","unfollow","unfollowUser"],"mappings":"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","sourcesContent":["import { updateObjectInArray } from '../utils/object-helpers';\nimport { usersAPI } from '../API/api'\n\nconst FOLLOW = 'FOLLOW';\nconst UNFOLLOW = 'UNFOLLOW';\nconst SET_USERS = 'SET_USERS';\nconst SET_CURRENT_PAGE = 'SET_CURRENT_PAGE';\nconst SET_TOTAL_USER_COUNT = 'SET_TOTAL_USER_COUNT';\nconst TOGGLE_IS_FETCHING = 'TOGGLE_IS_FETCHING';\nconst TOGGLE_IS_FOLLOWING_PROGRESS = 'TOGGLE_IS_FOLLOWING_PROGRESS';\n\nlet initialState = {\n    users: [],\n    pageSize: 10,\n    totalUsersCount: 0,\n    currentPage: 1,\n    isFetching: false,\n    followingInProgress: [],\n};\n\nconst usersReducer = (state = initialState, action) => {\n    switch (action.type) {\n        case FOLLOW:\n            return {\n                ...state,\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: true })\n                }\n\n        case UNFOLLOW:\n            return {\n                ...state,\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: false })\n            }\n        case SET_USERS:\n            return { ...state, users: action.users };\n\n        case SET_CURRENT_PAGE:\n            return { ...state, currentPage: action.currentPage };\n\n        case SET_TOTAL_USER_COUNT:\n            return { ...state, totalUsersCount: action.totalUsersCount };\n\n        case TOGGLE_IS_FETCHING:\n            return { ...state, isFetching: action.isFetching };\n\n        case TOGGLE_IS_FOLLOWING_PROGRESS:\n            return {\n                ...state,\n                followingInProgress: action.isFetching\n                    ? [...state.followingInProgress, action.userId]\n                    : state.followingInProgress.filter(id => id !== action.userId)\n            };\n\n        default:\n            return state;\n    };\n};\nexport const followSuccess = (userId) => ({ type: FOLLOW, userId });\nexport const unfollowSuccess = (userId) => ({ type: UNFOLLOW, userId });\nexport const setUsers = (users) => ({ type: SET_USERS, users });\nexport const setCurrentPage = (currentPage) => ({ type: SET_CURRENT_PAGE, currentPage });\nexport const setTotalUserCount = (totalUsersCount) => ({ type: SET_TOTAL_USER_COUNT, totalUsersCount });\nexport const toggleIsFetching = (isFetching) => ({ type: TOGGLE_IS_FETCHING, isFetching });\nexport const toggleIsFollowingProgress = (isFetching, userId) => ({ type: TOGGLE_IS_FOLLOWING_PROGRESS, isFetching, userId });\n\nexport const getUsers = (currentPage, pageSize) => {\n    return async (dispatch) => {\n        dispatch(toggleIsFetching(true));\n        dispatch(setCurrentPage(currentPage));\n        let data = await usersAPI.getUsers(currentPage, pageSize);\n        dispatch(toggleIsFetching(false));\n        dispatch(setUsers(data.items));\n        dispatch(setTotalUserCount(data.totalCount));\n\n    }\n}\n\nconst followUnfollowFlow = async (dispatch, userId, apiMethod, actionCreator) => {\n    dispatch(toggleIsFollowingProgress(true, userId));\n    let response = await apiMethod(userId);\n\n    if (response.resultCode === 0) {\n        dispatch(actionCreator(userId));\n    };\n    dispatch(toggleIsFollowingProgress(false, userId));\n}\n\nexport const follow = (userId) => {\n    return async (dispatch) => {\n        followUnfollowFlow(dispatch, userId, usersAPI.followUser.bind(usersAPI), followSuccess)\n    }\n};\n\nexport const unfollow = (userId) => {\n    return async (dispatch) => {\n        followUnfollowFlow(dispatch, userId, usersAPI.unfollowUser.bind(usersAPI), unfollowSuccess)\n    }\n}\n\nexport default usersReducer;"]},"metadata":{},"sourceType":"module"}